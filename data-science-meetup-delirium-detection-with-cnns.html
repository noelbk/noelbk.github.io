
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="Noel Burton-Krahn" />
        <meta name="keywords" content="log,eeg,cnn,nnet" />
        <meta name="description" content="Introduction Noel Burton-Krahn Delirium Detection in EEGs Got baseStudyEDF: control and delerium EEGs Total Control: 27 Total Delirium: 25 Neural Networks Images from CS231n Convolutional Neural Networks for Visual Recognition Convolutional Networks Deep Neural Networks Demo Digit Classifier 2D Visualization of a CNN by A Harley, Ryerson https://vimeo.com â€¦" />


    <title>Data Science Meetup: Delirium Detection With CNNs - Noel Burton-Krahn</title>

        <link rel="stylesheet" href="http://burton-krahn.com/theme/css/bootstrap.superhero.min.css" type="text/css"/>

    <link href="http://burton-krahn.com/theme/css/font-awesome.min.css" rel="stylesheet" />
    <link href="http://burton-krahn.com/theme/css/pygments/native.css" rel="stylesheet" />
    
    <link href="http://burton-krahn.com/theme/css/pelican-twitchy.min.css" rel="stylesheet" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Feeds -->
        <link href="http://burton-krahn.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Noel Burton-Krahn ATOM Feed" />
</head>
<body data-spy="scroll" data-target="#scrollspy">
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper-small" class="twitchy-background">
            <ul id="accordion-small" class="sidebar-nav sidebar-nav-small">
                <li>
        <a href="http://burton-krahn.com" title="Noel Burton-Krahn" class="collapsed">
            <span class="glyphicon glyphicon-home"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li>
        <a href="http://burton-krahn.com/archives.html" title="Recent Articles" class="collapsed">
            <span class="glyphicon glyphicon-th-list"></span>
        </a>
    </li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-social-small" title="Social" class="collapsed">
                        <i class="fa fa-users padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social-small" class="collapse ">
                    <li>
                        <a href="/static/NoelBurtonKrahnResume.pdf" title="Resume"><i class="fa fa-resume-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://github.com/noelbk" title="GitHub"><i class="fa fa-github-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="mailto:noel@burton-krahn.com" title="Email"><i class="fa fa-envelope-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://www.facebook.com/noel.burtonkrahn" title="Facebook"><i class="fa fa-facebook-square fa-lg padding-small"></i></a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
        <a href="#" title="Back to top" class="collapsed">
            <span class="fa fa-arrow-up"></span>
        </a>
    </li>
            </ul>
        </div>
        <div id="sidebar-wrapper" class="twitchy-background">
            <ul id="accordion" class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="http://burton-krahn.com/">
                            <span class="glyphicon glyphicon-home padding-small"></span>
                            Noel Burton-Krahn
                    </a>
                </li>
                    <li class="nav-divider"></li>
                    <li>
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse-latest">
                            <span class="glyphicon glyphicon-th-list padding-small"></span>
                            Recent Articles
                        </a>
                    </li>
                    <li class="panel anti-panel"><ul id="collapse-latest" class="sidebar_submenu collapse in">
                        <li class="active">
                            <a class="hide-overflow" href="http://burton-krahn.com/data-science-meetup-delirium-detection-with-cnns.html" title="Data Science Meetup: Delirium Detection With CNNs">
                                <i class="fa fa-file-text padding-small"></i>
                                Data Science Meetup: Delirium Detection With CNNs
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="http://burton-krahn.com/communicating-with-vegtative-patients.html" title="Communicating with vegtative patients">
                                <i class="fa fa-file-text padding-small"></i>
                                Communicating with vegtative patients
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="http://burton-krahn.com/deep-learning-for-medicine.html" title="Deep Learning for Medicine">
                                <i class="fa fa-file-text padding-small"></i>
                                Deep Learning for Medicine
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="http://burton-krahn.com/battlesnakes.html" title="Battlesnakes">
                                <i class="fa fa-file-text padding-small"></i>
                                Battlesnakes
                            </a>
                        </li>
                        <li class="">
                            <a class="hide-overflow" href="http://burton-krahn.com/if-a-number-is-divisible-by-3-then-so-is-the-sum-of-its-digits.html" title="If a number is divisible by 3, then so is the sum of its digits">
                                <i class="fa fa-file-text padding-small"></i>
                                If a number is divisible by 3, then so is the sum of its digits
                            </a>
                        </li>
                    <li>
                        <a href="http://burton-krahn.com/archives.html">
                            <i class="fa fa-arrow-right padding-small"></i>
                            More
                        </a>
                    </li>
                    </ul></li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-social">
                        <i class="fa fa-users padding-small"></i>
                        Contact
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social" class="sidebar_submenu collapse ">
                    <li>
                        <a href="/static/NoelBurtonKrahnResume.pdf" title="Resume">
                            <i class="fa fa-resume-square fa-lg padding-small"></i>
                            Resume
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/noelbk" title="GitHub">
                            <i class="fa fa-github-square fa-lg padding-small"></i>
                            GitHub
                        </a>
                    </li>
                    <li>
                        <a href="mailto:noel@burton-krahn.com" title="Email">
                            <i class="fa fa-envelope-square fa-lg padding-small"></i>
                            Email
                        </a>
                    </li>
                    <li>
                        <a href="https://www.facebook.com/noel.burtonkrahn" title="Facebook">
                            <i class="fa fa-facebook-square fa-lg padding-small"></i>
                            Facebook
                        </a>
                    </li>
                </ul></li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-pages">
                        <i class="fa fa-folder-open padding-small"></i>
                        Pages
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-pages" class="sidebar_submenu collapse ">
                    <li>
                        <a href="http://burton-krahn.com/pages/resume.html">
                            <i class="fa fa-file-text padding-small"></i>
                            Resume
                        </a>
                    </li>
                </ul></li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-categories">
                        <i class="fa fa-folder-open padding-small"></i>
                        Categories
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-categories" class="sidebar_submenu collapse ">
                    <li >
                        <a href="http://burton-krahn.com/category/humour.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            Humour
                            <span class="badge pull-right categorybadge">1</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="http://burton-krahn.com/category/log.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            log
                            <span class="badge pull-right categorybadge">1</span>
                        </a>
                    </li>
                    <li >
                        <a href="http://burton-krahn.com/category/math.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            Math
                            <span class="badge pull-right categorybadge">1</span>
                        </a>
                    </li>
                    <li >
                        <a href="http://burton-krahn.com/category/misc.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            misc
                            <span class="badge pull-right categorybadge">2</span>
                        </a>
                    </li>
                    <li >
                        <a href="http://burton-krahn.com/category/programming.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            Programming
                            <span class="badge pull-right categorybadge">2</span>
                        </a>
                    </li>
                </ul></li>
                
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->
        <!-- open/close sidebar -->
        <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">
            <span id="right-arrow" class="glyphicon glyphicon-chevron-right"  title="expand sidebar"></span>
            <span id="left-arrow" class="glyphicon glyphicon-chevron-left" title="minimize sidebar"></span>
        </a>
       <!-- /open/close sidebar -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
<section id="content">
    <article>
        <div class="row">
            <div class="col-lg-9">
                <header class="page-header">
                    <h1>
                        <a href="http://burton-krahn.com/data-science-meetup-delirium-detection-with-cnns.html"
                           rel="bookmark"
                           title="Permalink to Data Science Meetup: Delirium Detection With CNNs">
                            Data Science Meetup: Delirium Detection With CNNs
                        </a>
                    </h1>
                    <small>
<div class="post-info">
    <div class="publish-info-block">
        <small>
            <span class="published">
                <i class="fa fa-calendar padding-small"></i><time datetime="2017-07-26T00:00:00-07:00"> Wed 26 July 2017</time>
            </span>
            <span class="category">
                <i class="fa fa-folder-open padding-small"></i><a href="http://burton-krahn.com/category/log.html">log</a>
            </span>
            <span class="tags">
                <i class="fa fa-tags padding-small"></i>
                <a href="http://burton-krahn.com/tag/log.html">log</a> /                 <a href="http://burton-krahn.com/tag/eeg.html">eeg</a> /                 <a href="http://burton-krahn.com/tag/cnn.html">cnn</a> /                 <a href="http://burton-krahn.com/tag/nnet.html">nnet</a>            </span>
        </small>
    </div>
</div><!-- /.post-info -->                    </small>
                </header>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="entry-content">
                    <h1>Introduction</h1>
<p>Noel Burton-Krahn</p>
<h1>Delirium Detection in EEGs</h1>
<p>Got baseStudyEDF: control and delerium EEGs
Total Control: 27
Total Delirium: 25</p>
<p><img alt="baseStudyEDF" src="{filename}../static/2017-04-26/baseStudyEDF.png"></p>
<h1>Neural Networks</h1>
<p>Images from <a href="http://cs231n.github.io/convolutional-networks/">CS231n Convolutional Neural Networks for Visual Recognition</a></p>
<p><img alt="neural_net2" src="{filename}../static/20170727/neural_net2.jpeg"></p>
<p><img alt="cnn" src="{filename}../static/20170727/cnn.jpeg"></p>
<h2>Convolutional Networks</h2>
<p><img alt="convnet" src="{filename}../static/20170727/convnet.jpeg"></p>
<p><img alt="weights" src="{filename}../static/20170727/weights.jpeg"></p>
<h2>Deep Neural Networks</h2>
<p><img alt="AlexNet" src="{filename}../static/20170727/Figure-27-CNN-Architecture-from-AlexNet-32.jpg"></p>
<p><img alt="inception" src="{filename}../static/20170727/inception.png"></p>
<h2>Demo Digit Classifier</h2>
<p><a href="http://scs.ryerson.ca/~aharley/vis/conv/flat.html">2D Visualization of a CNN</a> by A Harley, Ryerson</p>
<p>https://vimeo.com/125940125</p>
<h1>A CNN for Delirium Detection</h1>
<p>Made 4<em>CONV + 2</em>FC CNN: avg*2, 64x8, 32x8, 16x8, 8x4, 64, 64, 1</p>
<p>in Python's Keras</p>
<div class="highlight"><pre><span></span>    Input(inputs.shape[1:])
    AveragePooling1D(pool_size=2)
    Conv1D(64, 8, activation=&#39;relu&#39;)
    MaxPooling1D()
    Conv1D(32, 8, activation=&#39;relu&#39;)
    MaxPooling1D()
    Conv1D(16, 8, activation=&#39;relu&#39;)
    MaxPooling1D()
    Conv1D(2, 8, activation=&#39;relu&#39;)
    MaxPooling1D(8)
    Flatten()
    Dense(64, activation=&#39;sigmoid&#39;,
          kernel_regularizer=regularizers.l2(0.01),
          activity_regularizer=regularizers.l1(0.01),
          )
    Dense(64, activation=&#39;sigmoid&#39;)
    Dense(1, activation=&#39;sigmoid&#39;)
</pre></div>


<p><img alt="baseStudyEDF" src="{filename}../static/2017-04-26/model.png"></p>
<h2>Training</h2>
<p>Trained on 3 splits: train on 66% of data, evaluate on 33% untrained
data.  Average accuracy: (94 + 100 + 82)/3 = 92%</p>
<p><img alt="baseStudyEDF" src="{filename}../static/2017-04-26/split0.png">
<img alt="baseStudyEDF" src="{filename}../static/2017-04-26/split1.png">
<img alt="baseStudyEDF" src="{filename}../static/2017-04-26/split2.png"></p>
<p>The training graphs demonstrate:</p>
<ul>
<li>
<p>92% accuracy on untrained validation data is pretty good</p>
</li>
<li>
<p>The training dataset is too small.  When the training accuracy goes
  to 100%, the net is overfitted to the data.</p>
</li>
</ul>
<p><img alt="split0.gif" src="{filename}../static/2017-04-27/model-split0.gif">
<img alt="split1.gif" src="{filename}../static/2017-04-27/model-split1.gif">
<img alt="split2.gif" src="{filename}../static/2017-04-27/model-split2.gif"></p>
<h1>CNNs are easily Fooled</h1>
<p><a href="https://blog.openai.com/adversarial-example-research/">Attacking Machine Learning with Adversarial Examples</a>
<img alt="blackbox" src="{filename}../static/20170727/adversarial_img_1.png"></p>
<p><a href="http://anhnguyen.me/project/fooling/">Deep Neural Network are Easily Fooled: High Confidence Predictions for Unrecognizable Images</a>
<img alt="blackbox" src="{filename}../static/20170727/diversity_40_images_label.png"></p>
<h2>The Black Box Problem</h2>
<p><img alt="blackbox" src="{filename}../static/20170727/blackbox.jpg"></p>
<p>Medical device approval requires justification.</p>
<h2>FDA Approval is Possible</h2>
<p>Despite the challenges, devices based on neural networks have recently
been granted FDA approval, and there are many startups emerging in
this space.</p>
<ul>
<li>
<p><a href="http://www.prnewswire.com/news-releases/arterys-receives-fda-clearance-for-the-first-zero-footprint-medical-imaging-analytics-cloud-software-with-deep-learning-for-cardiac-mri-300387880.html">Arterys Receives FDA Clearance For The First Zero-Footprint Medical Imaging Analytics Cloud Software With Deep Learning For Cardiac MRI</a></p>
</li>
<li>
<p><a href="http://www.fiercebiotech.com/medical-devices/arterys-nabs-second-fda-ok-for-deep-learning-image-analysis-software">Arterys nabs second FDA OK for deep learning, image analysis software</a></p>
</li>
<li>
<p><a href="https://www.google.ca/amp/www.nanalyze.com/2017/02/artificial-intelligence-medical-imaging/amp/">9 Artificial Intelligence Startups in Medical Imaging</a></p>
</li>
</ul>
<h1>CNN Analysis</h1>
<p>Did deeper analysis of the CNN convolution filters.  Convolution
filters are similar to wavelets in that they perform a multiscale
correlation of the input signal with learned feature fragments.  Lower
layers convolve with the outputs of upper layers to match larger scale
features.</p>
<p>These graphs show the input feature that maximizes neuron excitment
for each convolution filtter at each level.</p>
<p>The final correlation layer's output is passed through a
fully-connected network for final classification.</p>
<p><img alt="baseStudyEDF" src="{filename}../static/2017-04-26/model-split0-epoch28-val_acc0.94.hdf5-layer1.png">
<img alt="baseStudyEDF" src="{filename}../static/2017-04-26/model-split0-epoch28-val_acc0.94.hdf5-layer4.png">
<img alt="baseStudyEDF" src="{filename}../static/2017-04-26/model-split0-epoch28-val_acc0.94.hdf5-layer7.png">
<img alt="baseStudyEDF" src="{filename}../static/2017-04-26/model-split0-epoch28-val_acc0.94.hdf5-layer10.png"></p>
<h1>Other ways of looking at EEGS</h1>
<h2>Frequency spectrogram</h2>
<p>Spectrograms of 8 delirium and 8 control EEGs</p>
<p><img alt="eeg-spectrogram.png" src="{filename}../static/20170505/eeg-spectrogram.png"></p>
<h2>Wavelet transform</h2>
<p>Problem: The DWT is shift-variant</p>
<p>Solution?  The <a href="http://people.math.sc.edu/blanco/imi/dtcwt0.pdf">The Dual-Tree Complex Wavelet Transform</a> is shift-invariant</p>
<p><a href="https://pypi.python.org/pypi/dtcwt/">Python dtcwt</a></p>
<p>Here's the DTCWT vs the DWT for a control EEG</p>
<p><img alt="dtcwt-dwt-control1.png" src="{filename}../static/2017-05-02/dtcwt-dwt-control1.png"></p>
<p>And the DTCWT for a control vs delirium EEG</p>
<p><img alt="dtcwt1-control-delirum.png" src="{filename}../static/2017-05-02/dtcwt1-control-delirum.png"></p>
<p>Examining 8sec DWT samples grouped by patient, ordered by validate_acc
during training.  Each 8sec dwt block was used as a validation point
in 3 keras training runs, and sorted by average accuracy.  The results
were tabulated in a Jupyter notebook which could overlay blocks
interacively for visual comparison.</p>
<p>The most consistently accurate delirium blocks appeared to have high
frequency oscillations around coeffs 90-128.  Also sometimes high
amplitudes in the 1-64 coeff range.</p>
<p>The most consistently accurate control blocks has low frequency
oscillations around coeffs 90-128, and low amplitudes overall.</p>
<p>There were exceptions to these rules that were nevertheless
consistently accurate.</p>
<p><img alt="jupyter_validate_acc" src="{filename}/static/20170515/jupyter_validate_acc.png"></p>
<h2>Continuous wavelet transform of 8sec delirium eeg</h2>
<p>From noel/classifiers/CWTTest.ipynb</p>
<p><img alt="dwt-cwt" src="{filename}/static/20170519/20170519-cwt.png"></p>
<h2>Trying CNN on Wavelet transform</h2>
<p>Goal: to find a wavelet basis that isolates the delirium features.</p>
<p>Found: dtcwt scales 6-8, (8Hz, 4Hz, 2Hz, 896 points per sample, from
32k), fc16, fc16 nnet: 98.1%</p>
<video width="720" height="240" controls>
  <source src="../../static/2017-05-03/eeg-ddtcwt-nnet-coeffs4-5-fc16.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>

<h1>Conclusions</h1>
<ul>
<li>
<p>Deep networks can produce high accuracy</p>
</li>
<li>
<p>But they can be fooled, and the error resonse is unknown</p>
</li>
<li>
<p>They need to be fully explained to satisfy regulatory requirements</p>
</li>
</ul>
<h1>Future Work</h1>
<ul>
<li>
<p>Maybe a CNN with smaller FC layers would be easier:  just convolutions, no fully-connected layers?</p>
</li>
<li>
<p>Try in wavelet domain to reduce convolutional layers</p>
</li>
<li>
<p>Try genetic algorithm for optimizing layers</p>
</li>
</ul>
                </div>
                <footer class="text-right">
                  <p>- Noel Burton-Krahn</p>
                </footer>
    <section id="comments" class="comments ">
        <hr/>
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </section>
            </div>
        </div>
    </article>
</section>
<footer>
    <hr>
    <div class="row">
        <div class="col-lg-9 text-center">
            <p><small>
                Built by <a href="http://docs.getpelican.com/en/latest">Pelican</a> / <a href="https://github.com/ingwinlu/pelican-twitchy">pelican-twitchy</a>
                &middot;                    &copy; 2017 Noel Burton-Krahn
            </small></p>
        </div>
    </div>
</footer>            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.2 -->
    <script src="http://burton-krahn.com/theme/js/jquery-1.11.2.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="http://burton-krahn.com/theme/js/bootstrap.min.js"></script>
    <!-- twitchy Script -->
    <script src="http://burton-krahn.com/theme/js/pelican_twitchy.min.js"></script>

<!-- disqus -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'noel-burton-krahn'; // required: replace example with your forum shortname

            var disqus_identifier = 'data-science-meetup-delirium-detection-with-cnns';
        var disqus_url = 'http://burton-krahn.com/data-science-meetup-delirium-detection-with-cnns.html';

    var disqus_config = function () {
        this.language = "en";
    };
        /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- /disqus -->
</body>
</html>